import numpy as np
import matplotlib.pyplot as plt
from skimage.io import imread, imshow
from skimage.color import rgb2gray
from skimage.feature import match_template, peak_local_max
from skimage import transform

#Load images

img_dir=r"Place the path of the C drive in which you have save the captured frames using "
data_path=os.path.join(img_dir,'*.jpg')
files=glob.iglob(data_path)
data=[]
for f in files:
    img=cv2.imread(f)
    img1=cv2.cvtColor(img,cv2.COLOR_RGB2GRAY)
    data.append(img1)
    
#print(len(data))
'''for i in range(len(data)):
    plt.imshow(data[i],cmap='gray')
    plt.show()'''

img=cv2.imread("Calibration Template.jpg")
img=cv2.cvtColor(img,cv2.COLOR_RGB2GRAY)

def find_template(image):
    #fig,ax=plt.subplots(1,2,figsize=(14,10))
    #template=img
    #template=image[y:y+y_width,x:x+x_width]
    #ax[0].imshow(img,cmap='gray')
    result=match_template(image,template)
    #ax[1].imshow(result,cmap='gray');
    coor_x,coor_y=np.unravel_index(np.argmax(result),result.shape)
    return coor_x,coor_y,template,result
for i in range(len(data)):
    x,y,template,result=find_template(data[i])
    plt.imshow(data[i],cmap='gray')
    template_width,template_height=template.shape
    for x,y in peak_local_max(result,threshold_abs=0.92):
        rect=plt.Rectangle((y,x),template_height,template_width,color='r',fc='none')
        plt.gca().add_patch(rect);
    plt.show()
